{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medad - مداد</title>
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- رابط أيقونات Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    {% block head %} {% endblock %}
</head>
<body>
    <header class="header">
        {% include "main/header.html" %}
    </header>
      <!-- شاشة البداية -->
    <div id="splash">
        <video autoplay muted playsinline>
            <source src="{% static 'video/intro.mp4' %}" type="video/mp4">
        </video>
    </div>
    <main>
        {% block body %} {% endblock %}
    </main>
    <footer class="footer">
        {% include "main/footer.html" %}
    </footer>

{% if user.is_authenticated %}
<!-- الزر العائم -->
<button id="suggestion-btn" class="floating-btn">
    <i class="fas fa-envelope"></i>
</button>
{% endif %}

<!-- النافذة المنبثقة -->
<div id="suggestion-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3>📩 مقترح جديد</h3>
        <form method="post" action="{% url 'add_suggestion' %}">
            {% csrf_token %}
            
            <!-- حقل المحتوى -->
            <div class="form-group">
                <label for="content">المقترح <span class="required">*</span></label>
                <textarea class="form-control" id="content" name="content" maxlength="255" required placeholder="أدخل مقترحك هنا..."></textarea>
                <div class="char-count">عدد الأحرف: <span id="charCount">0</span>/255</div>
            </div>

            <div class="buttons">
                <button type="submit" class="btn btn-success"><i class="fas fa-check"></i> إرسال</button>
                {% comment %} <button type="button" class="btn btn-secondary close"><i class="fas fa-times"></i> إلغاء</button> {% endcomment %}
            </div>
        </form>
    </div>
</div>


    <script>
        const splash = document.getElementById("splash");
        const content = document.getElementById("content");
        const video = splash.querySelector("video");

        // عند انتهاء الفيديو
        video.onended = () => {
        splash.style.display = "none";
        content.classList.add("show");
        document.body.style.overflow = "auto";
        };

        setTimeout(() => {
        if (splash.style.display !== "none") {
            splash.style.display = "none";
            content.classList.add("show");
            document.body.style.overflow = "auto";
        }
        }, 2000);



        // فتح وإغلاق النافذة
        const modal = document.getElementById("suggestion-modal");
        const btn = document.getElementById("suggestion-btn");
        const closes = document.querySelectorAll(".close");

        btn.onclick = () => modal.style.display = "block";
        closes.forEach(c => c.onclick = () => modal.style.display = "none");

        // إغلاق عند الضغط خارج المودال
        window.onclick = e => { if (e.target == modal) modal.style.display = "none"; }

                // عد الأحرف للمقترح
        const contentTextarea = document.getElementById('content');
        const charCount = document.getElementById('charCount');
        
        contentTextarea.addEventListener('input', function() {
            const length = this.value.length;
            charCount.textContent = length;
            
            if (length > 240) {
                charCount.style.color = '#e74c3c';
            } else {
                charCount.style.color = '#7f8c8d';
            }
        });
        
        // إضافة تأثير عند النقر على زر الإلغاء
        document.querySelector('.close').addEventListener('click', function() {
            if (confirm('هل أنت متأكد من إلغاء عملية الإرسال؟')) {
                window.location.href = '/'; // تغيير هذا الرابط حسب احتياجك
            }
        });
    </script>

</body>
</html>
